import * as $rjs_core from '../../../runtime/core.js';import * as M0 from "../../../runtime/kernel.rkt.js";var path_string_p = function(s108) {var or_part109 = M0.path_p(s108);if (or_part109!==false) {var if_res83 = or_part109;} else {if (M0.string_p(s108)!==false) {var or_part110 = M0.__rjs_quoted__.relative_path_p(s108);if (or_part110!==false) {var if_res81 = or_part110;} else {var if_res81 = M0.__rjs_quoted__.absolute_path_p(s108);}var if_res82 = if_res81;} else {var if_res82 = false;}var if_res83 = if_res82;}return if_res83;};var bsbs = M0.string($rjs_core.Char.charFromCodepoint(92),$rjs_core.Char.charFromCodepoint(92));var normal_case_path = function(s111) {var or_part112 = M0.__rjs_quoted__.path_for_some_system_p(s111);if (or_part112!==false) {var if_res84 = or_part112;} else {var if_res84 = path_string_p(s111);}if (if_res84!==false) {var if_res85 = M0.rvoid();} else {var if_res85 = M0.raise_argument_error($rjs_core.PrimitiveSymbol.make("normal-path-case"),$rjs_core.UString.make("(or/c path-for-some-system? path-string?)"),s111);}if_res85;if (M0.__rjs_quoted__.path_for_some_system_p(s111)!==false) {var if_res86 = M0.eq_p(M0.__rjs_quoted__.path_convention_type(s111),$rjs_core.PrimitiveSymbol.make("windows"));} else {var if_res86 = M0.eq_p(M0.system_type(),$rjs_core.PrimitiveSymbol.make("windows"));}if (if_res86!==false) {if (M0.string_p(s111)!==false) {var if_res87 = false;} else {var if_res87 = M0.__rjs_quoted__.path__gt_bytes(s111);}var bstr113 = if_res87;if (M0.string_p(s111)!==false) {var if_res88 = M0.regexp_match_p($rjs_core.Regexp.fromString("^[\\][\\][?][\\]"),s111);} else {var if_res88 = false;}if (if_res88!==false) {var if_res97 = M0.string__gt_path(s111);} else {if (bstr113!==false) {var if_res89 = M0.regexp_match_p($rjs_core.Regexp.fromString("^[\\][\\][?][\\]"),bstr113);} else {var if_res89 = false;}if (if_res89!==false) {var if_res96 = s111;} else {var norm114 = function(s117) {return M0.__rjs_quoted__.string_locale_downcase(M0.__rjs_quoted__.regexp_replace_times_($rjs_core.Regexp.fromString("/"),s117,bsbs));};var norm_tail115 = function(s118) {if (M0.regexp_match_p($rjs_core.Regexp.fromString("[/\\][. ]+[/\\]*$"),s118)!==false) {var if_res90 = s118;} else {var if_res90 = M0.__rjs_quoted__.regexp_replace_times_($rjs_core.Regexp.fromString("(?<=[^ ./\\])[ .]+([/\\]*)$"),s118,$rjs_core.UString.make("\\1"));}return if_res90;};var finish116 = function(bstr119) {return M0.__rjs_quoted__.bytes__gt_path(bstr119,$rjs_core.PrimitiveSymbol.make("windows"));};if (M0.string_p(s111)!==false) {var if_res95 = finish116(M0.string__gt_bytes_by_locale(norm114(norm_tail115(s111))));} else {var c120 = M0.__rjs_quoted__.bytes_open_converter($rjs_core.UString.make(""),$rjs_core.UString.make("UTF-8"));var loop121 = function(offset122) {var let_result91 = M0.__rjs_quoted__.bytes_convert(c120,bstr113,offset122,M0.bytes_length(bstr113));var new_bstr123 = let_result91.getAt(0);var used124 = let_result91.getAt(1);var status125 = let_result91.getAt(2);var s126 = M0.__rjs_quoted__.bytes__gt_string_by_locale(new_bstr123);if (M0.eq_p(status125,$rjs_core.PrimitiveSymbol.make("complete"))!==false) {var if_res92 = norm_tail115(s126);} else {var if_res92 = s126;}var tail_s127 = if_res92;var done128 = M0.string__gt_bytes_by_locale(norm114(tail_s127));if (M0.eq_p(status125,$rjs_core.PrimitiveSymbol.make("complete"))!==false) {var if_res94 = done128;} else {if (M0.eq_p(status125,$rjs_core.PrimitiveSymbol.make("aborts"))!==false) {var if_res93 = M0.bytes_append(done128,M0.__rjs_quoted__.subbytes(bstr113,offset122+used124));} else {var if_res93 = M0.bytes_append(done128,M0.__rjs_quoted__.subbytes(bstr113,offset122+used124,offset122+used124+1),loop121(offset122+used124+1));}var if_res94 = if_res93;}return if_res94;};var if_res95 = finish116(loop121(0));}var if_res96 = if_res95;}var if_res97 = if_res96;}var if_res99 = if_res97;} else {if (M0.string_p(s111)!==false) {var if_res98 = M0.string__gt_path(s111);} else {var if_res98 = s111;}var if_res99 = if_res98;}return if_res99;};var check_extension_call = function(s129, sfx130, who131, sep132, trust_sep_p133) {var or_part136 = M0.__rjs_quoted__.path_for_some_system_p(s129);if (or_part136!==false) {var if_res100 = or_part136;} else {var if_res100 = path_string_p(s129);}if (M0.not(if_res100)!==false) {var if_res106 = M0.values($rjs_core.UString.make("(or/c path-for-some-system? path-string?)"),0);} else {var or_part137 = M0.string_p(sfx130);if (or_part137!==false) {var if_res101 = or_part137;} else {var if_res101 = M0.bytes_p(sfx130);}if (M0.not(if_res101)!==false) {var if_res105 = M0.values($rjs_core.UString.make("(or/c string? bytes?)"),1);} else {var or_part138 = trust_sep_p133;if (or_part138!==false) {var if_res103 = or_part138;} else {var or_part139 = M0.string_p(sep132);if (or_part139!==false) {var if_res102 = or_part139;} else {var if_res102 = M0.bytes_p(sep132);}var if_res103 = if_res102;}if (M0.not(if_res103)!==false) {var if_res104 = M0.values($rjs_core.UString.make("(or/c string? bytes?)"),2);} else {var if_res104 = M0.values(false,false);}var if_res105 = if_res104;}var if_res106 = if_res105;}var let_result107 = if_res106;var err_msg134 = let_result107.getAt(0);var err_index135 = let_result107.getAt(1);if (err_msg134!==false) {if (trust_sep_p133!==false) {var if_res108 = M0.raise_argument_error(who131,err_msg134,err_index135,s129,sfx130);} else {var if_res108 = M0.raise_argument_error(who131,err_msg134,err_index135,s129,sfx130,sep132);}var if_res109 = if_res108;} else {var if_res109 = M0.rvoid();}if_res109;var let_result110 = M0.__rjs_quoted__.split_path(s129);var base140 = let_result110.getAt(0);var name141 = let_result110.getAt(1);var dir_p142 = let_result110.getAt(2);if (M0.not(base140)!==false) {var if_res111 = M0.raise_mismatch_error(who131,$rjs_core.UString.make("cannot add an extension to a root path: "),s129);} else {var if_res111 = M0.rvoid();}if_res111;return M0.values(base140,name141);};var path_adjust_extension = function(name143, sep144, rest_bytes145, s146, sfx147, trust_sep_p148) {var let_result112 = check_extension_call(s146,sfx147,name143,sep144,trust_sep_p148);var base149 = let_result112.getAt(0);var name150 = let_result112.getAt(1);var bs151 = M0.__rjs_quoted__.path_element__gt_bytes(name150);var finish152 = function(i153, sep154, i2155) {var temp117 = M0.__rjs_quoted__.subbytes(bs151,0,i153);if (M0.string_p(sep154)!==false) {var if_res116 = M0.string__gt_bytes_by_locale(sep154,M0.char__gt_integer($rjs_core.Char.charFromCodepoint(63)));} else {var if_res116 = sep154;}var temp115 = rest_bytes145(bs151,i2155);if (M0.string_p(sfx147)!==false) {var if_res114 = M0.string__gt_bytes_by_locale(sfx147,M0.char__gt_integer($rjs_core.Char.charFromCodepoint(63)));} else {var if_res114 = sfx147;}var temp118 = M0.bytes_append(temp117,if_res116,temp115,if_res114);if (M0.__rjs_quoted__.path_for_some_system_p(s146)!==false) {var if_res113 = M0.__rjs_quoted__.path_convention_type(s146);} else {var if_res113 = M0.__rjs_quoted__.system_path_convention_type();}return M0.__rjs_quoted__.bytes__gt_path_element(temp118,if_res113);};var loop157 = function(i158) {if (M0.zero_p(i158)!==false) {var if_res121 = finish152(M0.bytes_length(bs151),$rjs_core.Bytes.fromIntArray([]),M0.bytes_length(bs151));} else {var i159 = M0.sub1(i158);if (M0.not(M0.zero_p(i159))!==false) {var if_res119 = M0.eq_p(M0.char__gt_integer($rjs_core.Char.charFromCodepoint(46)),M0.bytes_ref(bs151,i159));} else {var if_res119 = false;}if (if_res119!==false) {var if_res120 = finish152(i159,sep144,M0.add1(i159));} else {var if_res120 = loop157(i159);}var if_res121 = if_res120;}return if_res121;};var new_name156 = loop157(M0.bytes_length(bs151));if (M0.__rjs_quoted__.path_for_some_system_p(base149)!==false) {var if_res122 = M0.build_path(base149,new_name156);} else {var if_res122 = new_name156;}return if_res122;};var path_replace_extension = function(s160, sfx161) {return path_adjust_extension($rjs_core.PrimitiveSymbol.make("path-replace-extension"),$rjs_core.Bytes.fromIntArray([]),function(bs162, i163) {return $rjs_core.Bytes.fromIntArray([]);},s160,sfx161,true);};var cl123 = function(s164, sfx165) {return path_adjust_extension($rjs_core.PrimitiveSymbol.make("path-add-extension"),$rjs_core.Bytes.fromIntArray([95]),M0.__rjs_quoted__.subbytes,s164,sfx165,true);};var cl124 = function(s166, sfx167, sep168) {return path_adjust_extension($rjs_core.PrimitiveSymbol.make("path-add-extension"),sep168,M0.__rjs_quoted__.subbytes,s166,sfx167,false);};var path_add_extension = $rjs_core.attachProcedureArity(function() {var fixed_lam125 = {'2':cl123,'3':cl124}[arguments.length];if (fixed_lam125!==undefined) {return fixed_lam125.apply(null,arguments);} else {return M0.error($rjs_core.UString.make("case-lambda: invalid case"));}},[2,3]);var reroot_path = function(p169, root170) {var or_part171 = path_string_p(p169);if (or_part171!==false) {var if_res126 = or_part171;} else {var if_res126 = M0.__rjs_quoted__.path_for_some_system_p(p169);}if (if_res126!==false) {var if_res127 = M0.rvoid();} else {var if_res127 = M0.raise_argument_error($rjs_core.PrimitiveSymbol.make("reroot-path"),$rjs_core.UString.make("(or/c path-string? path-for-some-system?)"),0,p169,root170);}if_res127;var let_result128 = M0.values();var or_part172 = path_string_p(root170);if (or_part172!==false) {var if_res129 = or_part172;} else {var if_res129 = M0.__rjs_quoted__.path_for_some_system_p(root170);}if (if_res129!==false) {var if_res130 = M0.rvoid();} else {var if_res130 = M0.raise_argument_error($rjs_core.PrimitiveSymbol.make("reroot-path"),$rjs_core.UString.make("(or/c path-string? path-for-some-system?)"),1,p169,root170);}if_res130;var let_result131 = M0.values();if (M0.__rjs_quoted__.path_for_some_system_p(p169)!==false) {var if_res132 = M0.__rjs_quoted__.path_convention_type(p169);} else {var if_res132 = M0.__rjs_quoted__.system_path_convention_type();}var conv173 = if_res132;var or_part174 = M0.__rjs_quoted__.complete_path_p(p169);if (or_part174!==false) {var if_res133 = or_part174;} else {var if_res133 = M0.eq_p(M0.__rjs_quoted__.system_path_convention_type(),conv173);}if (if_res133!==false) {var if_res134 = M0.rvoid();} else {var if_res134 = M0.raise_arguments_error($rjs_core.PrimitiveSymbol.make("reroot-path"),$rjs_core.UString.make("path is not complete and not the platform's convention"),$rjs_core.UString.make("path"),p169,$rjs_core.UString.make("platform convention type"),M0.__rjs_quoted__.system_path_convention_type());}if_res134;var let_result135 = M0.values();if (M0.__rjs_quoted__.path_for_some_system_p(root170)!==false) {var if_res136 = M0.__rjs_quoted__.path_convention_type(root170);} else {var if_res136 = M0.__rjs_quoted__.system_path_convention_type();}if (M0.eq_p(if_res136,conv173)!==false) {var if_res137 = M0.rvoid();} else {var if_res137 = M0.raise_arguments_error($rjs_core.PrimitiveSymbol.make("reroot-path"),$rjs_core.UString.make("given paths use different conventions"),$rjs_core.UString.make("path"),p169,$rjs_core.UString.make("root path"),root170);}if_res137;var let_result138 = M0.values();if (M0.__rjs_quoted__.complete_path_p(p169)!==false) {var if_res139 = p169;} else {var if_res139 = M0.__rjs_quoted__.path__gt_complete_path(p169);}var c_p175 = normal_case_path(M0.__rjs_quoted__.cleanse_path(if_res139));var bstr176 = M0.__rjs_quoted__.path__gt_bytes(c_p175);if (M0.eq_p(conv173,$rjs_core.PrimitiveSymbol.make("unix"))!==false) {if (M0.bytes_eq__p(bstr176,$rjs_core.Bytes.fromIntArray([47]))!==false) {if (M0.__rjs_quoted__.path_for_some_system_p(root170)!==false) {var if_res140 = root170;} else {var if_res140 = M0.string__gt_path(root170);}var if_res141 = if_res140;} else {var if_res141 = M0.build_path(root170,M0.__rjs_quoted__.bytes__gt_path(M0.__rjs_quoted__.subbytes(M0.__rjs_quoted__.path__gt_bytes(c_p175),1),conv173));}var if_res148 = if_res141;} else {if (M0.eq_p(conv173,$rjs_core.PrimitiveSymbol.make("windows"))!==false) {if (M0.regexp_match_p($rjs_core.Regexp.fromString("^\\\\\\\\[?]\\\\[a-z]:"),bstr176)!==false) {var if_res146 = M0.bytes_append($rjs_core.Bytes.fromIntArray([92,92,63,92,82,69,76,92]),M0.__rjs_quoted__.subbytes(bstr176,4,5),$rjs_core.Bytes.fromIntArray([92]),M0.__rjs_quoted__.subbytes(bstr176,6));} else {if (M0.regexp_match_p($rjs_core.Regexp.fromString("^\\\\\\\\[?]\\\\UNC\\\\"),bstr176)!==false) {var if_res145 = M0.bytes_append($rjs_core.Bytes.fromIntArray([92,92,63,92,82,69,76,92]),M0.__rjs_quoted__.subbytes(bstr176,4));} else {if (M0.regexp_match_p($rjs_core.Regexp.fromString("^\\\\\\\\[?]\\\\UNC\\\\"),bstr176)!==false) {var if_res144 = M0.bytes_append($rjs_core.Bytes.fromIntArray([92,92,63,92,82,69,76,92]),M0.__rjs_quoted__.subbytes(bstr176,4));} else {if (M0.regexp_match_p($rjs_core.Regexp.fromString("^\\\\\\\\"),bstr176)!==false) {var if_res143 = M0.bytes_append($rjs_core.Bytes.fromIntArray([85,78,67,92]),M0.__rjs_quoted__.subbytes(bstr176,2));} else {if (M0.regexp_match_p($rjs_core.Regexp.fromString("^[a-z]:"),bstr176)!==false) {var if_res142 = M0.bytes_append(M0.__rjs_quoted__.subbytes(bstr176,0,1),M0.__rjs_quoted__.subbytes(bstr176,2));} else {var if_res142 = M0.rvoid();}var if_res143 = if_res142;}var if_res144 = if_res143;}var if_res145 = if_res144;}var if_res146 = if_res145;}var if_res147 = M0.build_path(root170,M0.__rjs_quoted__.bytes__gt_path(if_res146,conv173));} else {var if_res147 = M0.rvoid();}var if_res148 = if_res147;}return if_res148;};var __rjs_quoted__ = {};export { __rjs_quoted__,reroot_path,path_add_extension,path_replace_extension,normal_case_path,path_string_p };